YUI.add("snowplough",(function(e,n){var o=require("hermes-core/flog")(n),t={USER:"iglu:com.flickr/user/jsonschema/3-0-1",EXPERIMENT:"iglu:com.flickr/experiment/jsonschema/1-0-0",SEGMENT:"iglu:com.flickr/segment/jsonschema/1-0-0",ADD_TO_CART:"iglu:com.snowplowanalytics.snowplow/add_to_cart/jsonschema/1-0-0",SUBSCRIPTION_PURCHASE_EVENT:"iglu:com.flickr/subscription_purchase/jsonschema/1-0-1",SUBSCRIPTION_CANCEL_FLOW_EVENT:"iglu:com.flickr/subscription_cancel/jsonschema/1-0-6",SUBSCRIPTION_PURCHASE_FUNNEL_EVENT:"iglu:com.flickr/subscription_purchase_funnel/jsonschema/1-0-1",PHOTO:"iglu:com.flickr/photo/jsonschema/1-0-2",PAGE:"iglu:com.flickr/page/jsonschema/1-0-0",EVENT_LINK:"iglu:com.flickr/event/jsonschema/1-0-0",GROUP:"iglu:com.flickr/group/jsonschema/1-0-0",GROUP_DISCUSSION:"iglu:com.flickr/group_discussion/jsonschema/2-0-0",GALLERY:"iglu:com.flickr/gallery/jsonschema/4-0-0",ALBUM:"iglu:com.flickr/album/jsonschema/4-0-0",GIFT:"iglu:com.flickr/gift_purchase/jsonschema/2-0-0"};e.Snowplough=(function(){var n;function i(e){var n=[{schema:t.EVENT_LINK,data:{linkID:null}}];return e&&e.linkID&&(n[0].data.linkID=e.linkID.toString()),n}function a(e){if(window.snowplow){var n=l();if(e&&e.getAdditionalSpContexts){var t=e.getAdditionalSpContexts();t.length&&(n=t.concat(n))}o.info("Page view contexts",n),window.snowplow("trackPageView",{context:n}),o.info("Page view event sent")}}function r(){window.snowplow&&(window&&window.dataLayer&&window.dataLayer.user&&window.dataLayer.user.profileInfo?(window.snowplow("setUserId",window.dataLayer.user.profileInfo.profileID),o.info("Set snowplow user id",window.dataLayer.user.profileInfo.profileID)):o.info("Cant set snowplow user id"))}function l(){return[].concat((function(){var e=[{schema:t.PAGE,data:{module:null}}];if(window&&window.appContext&&window.appContext.flapp&&window.appContext.flapp.get("activeView")){let n=window.appContext.routeConfig,o=window.appContext.flapp;e[0].data.module=n&&n.meta&&n.meta.type?o.get("activeView").name+"_"+n.meta.type:o.get("activeView").name}return e})()).concat((function(){var e=[];if(window&&window.appContext){if(window.appContext.flipper&&window.appContext.flipper.config)["enable-photo-page-ad-experiment","enable-targeted-conversion"].forEach((function(n){window.appContext.flipper.config[n]&&e.push({schema:t.EXPERIMENT,data:{flipperName:n,flipperValue:window.appContext.flipper.config[n]}})}))}return e})()).concat((function(){var e=[];if(window&&window.appContext&&window.appContext.getViewer&&window.appContext.getViewer()&&window.appContext.getViewer().signedIn){var n=window.appContext.getViewer().segments;n&&n.length&&n.forEach((function(n){e.push({schema:t.SEGMENT,data:{segment:n}})}))}return e})()).concat((function(){var e=[{schema:t.USER,data:{nsid:null,signedIn:null,pro:null,cookie_consent_level:null,hasAdBlock:null}}];if(window&&window.dataLayer&&window.dataLayer.user&&window.dataLayer.user&&window.dataLayer.user.profileInfo){var n=window.dataLayer.user,i=window.appContext.getCookie("ccc")||null;try{i=JSON.parse(i)}catch(e){o.error("Cannot parse JSON in snowplough.js getUserContext")}n.profileInfo.profileID&&(e[0].data.nsid=n.profileInfo.profileID),"signedIn"in n.profileInfo&&(e[0].data.signedIn=n.profileInfo.signedIn),"pro"in n.segments&&(e[0].data.pro=n.segments.pro),i&&i.info&&i.info.cookieBlock&&"level"in i.info.cookieBlock&&(e[0].data.cookie_consent_level=i.info.cookieBlock.level),e[0].data.hasAdBlock=window.appContext.getViewer().userAdBlockEnabled,o.info("Called getUserContext to attach with a snowplow event",e)}else o.info("dataLayer empty",window.dataLayer);return e})())}function s(e){return c({id:e.getValue("id"),safetyLevel:e.getValue("safetyLevel"),owner:{nsid:e.getValue("owner").getValue("id"),isPro:e.getValue("owner").getValue("isPro")}})}function c(e){var n=[{schema:t.PHOTO,data:{id:null,safetyLevel:null,owner_nsid:null,owner_isPro:null}}];return e.id&&null!==e.safetyLevel&&(n[0].data.id=parseInt(e.id,10)),null!==e.safetyLevel&&(n[0].data.safetyLevel=parseInt(e.safetyLevel,10)),void 0!==e.owner&&(n[0].data.owner_nsid=e.owner.nsid,n[0].data.owner_isPro=e.owner.isPro),n}function d(e){var n=[{schema:t.GROUP,data:{id:null}}];return e.id&&(n[0].data.id=parseInt(e.id,10)),n}function w(e,n){var o=[];return o=(o=o.concat(d(n))).concat((function(e){var n=[{schema:t.GROUP_DISCUSSION,data:{id:null}}];return e.id&&(n[0].data.id=parseInt(e.id,10)),n})(e)),o}function p(e){var n=[{schema:t.GALLERY,data:{id:null,photoIds:null}}];return e.id&&(n[0].data.id=parseInt(e.id,10)),e.photoIds&&e.photoIds.length>0&&(n[0].data.photoIds=e.photoIds),n}function u(e){var n=[{schema:t.ALBUM,data:{id:null,photoIds:null}}];return e.id&&(n[0].data.id=parseInt(e.id,10)),e.photoIds&&e.photoIds.length>0&&(n[0].data.photoIds=e.photoIds),n}function f(e,n){if(window.snowplow&&e){var t=l();n&&n.length>0&&(t=t.concat(n)),t.length>0&&(e.context=t),window.snowplow("trackStructEvent",e),o.info("Structured event sent",e.name,e)}}function g(e){window.snowplow&&e&&(window.snowplow("trackSelfDescribingEvent",{event:{schema:e.schema,data:e.data},context:l()}),o.info("Self describing event sent",e))}function m(e){window.snowplow("trackSiteSearch",{terms:[e.keyword||""],filters:{category:e.category},totalResults:e.totalResults,pageResults:e.pageResults}),o.info("Search event sent",e)}function h(){if(e.Snowplough){var n=new RegExp("_sp_id\\.[a-f0-9]+=([^;]+);?"),o=document.cookie.match(n);return!(!o||!o[1])&&o[1].split(".")[0]}}return n||(n=(function(){var e="t.flickr.com";if(window&&window.snowplow)return window.snowplow("newTracker","co",e,{appId:"flickr",platform:"web",post:!0,discoverRootDomain:!0,contexts:{webPage:!0,performanceTiming:!0}}),window.snowplow("enableActivityTracking",{minimumVisitLength:10,heartbeatDelay:10}),window.snowplow("enableLinkClickTracking"),o.info("Snowplow ready to collect on t.flickr.com"),{setUserId:r,sendPageView:a,sendStructuredEvent:f,sendSelfDescribingEvent:g,sendSearchEvent:m,getPhotoContext:c,getPhotoContextFromModel:s,getGroupDiscussionContexts:w,getGalleryContext:p,getAlbumContext:u,getGroupContext:d,SCHEMAS:t,getAdsContextEvents:i,getUUID:h};o.error("Missing snowplow.js in window")})()),n})()}),"@VERSION@",{requires:["snow"],affinity:"client"});YUI.add("client-app",(function(e,n){var t,i,r=require("hermes-core/flog")(n),o=!1,a=e.config.flickr.clientNavEnabled,s=!1;function c(){a=!1}function l(n){var t,i,r=window.location,o=window.history,a=!1;if(r.search&&o.replaceState&&(t=e.QueryString.parse(r.search.replace("?","")),n.forEach((function(e){e in t&&(delete t[e],a=!0)})),a)){i=e.QueryString.stringify(t);try{o.replaceState({},"",r.pathname+(i?"?"+i:""))}catch(e){}}}function u(e,n){return new n.Promise((function(t,i){n.use(e,(function(e,n){n&&"success"in n?n.success?t(e):i(n.msg):i("Y.use: no status provided")}))}))}function d(n){var i,r,o,a,s=[],c=["flickr.photos.addView","flickr.groups.updateViewDate","flickr.photos.getPhotos","flickr.people.addView","flickr.photosets.addView"];if(t.getViewCounter().flushQueue(),t.uploadIsInProgress())a=this.intlMessage({intlName:"client-app.UPLOAD_IN_PROGRESS"});else{for(i in t.writeAPICallsMadeOnThisPage)(r=t.writeAPICallsMadeOnThisPage[i]).completed||s.push(r);s.length&&(s.every((function(e){return-1!==c.indexOf(e.methodName)}))||(e.config.flickr.requestConfig&&e.config.flickr.requestConfig.auth&&e.config.flickr.requestConfig.auth.isInsecureGod?(o=s.map((function(e){return e.methodName})).join(", "),a=this.intlMessage({intlName:"client-app.SAVING_LAST_ACTIONS"})+" In progress API Methods: "+o):a=this.intlMessage({intlName:"client-app.SAVING_LAST_ACTIONS"})))}return e.Storage.Instance.clear(),a&&((n||window.event).returnValue=a),a}function f(n){if(!a)return window.location=n.url,void n.halt();t.setClientSideRouted(!0),t.setPreviousLocation(),t.updateModelRefetchState(n.url,n.originEvent&&n.originEvent.currentTarget&&n.originEvent.currentTarget.hasClass("do-not-evict")),t.clearWriteAPICallCache(),t.setGPCredentials(null),e.loaderBar.start(),t.adManager.isEnabled()&&t.adManager.currentlyShowingAd&&t.adManager.adIsUnloading(),t.adManager.destroyAdUnitsOnPage(),t.getKeyboardManager().resetCurrentKeyEventScope(),e.Object.each(t.modelRegistries,(function(e,n){e.hasWeakSubscribers&&e.removeWeakSubscribers()})),o=!0}function g(){e.UA.chrome>0&&(window.scrollTo(window.scrollX,window.scrollY+1),window.scrollTo(window.scrollX,window.scrollY-1))}function p(n){e.Object.each(t.modelRegistries,(function(e,n){e.hasWeakSubscribers&&e.removeWeakSubscribers()})),e.fire("close-dialogs"),"popstate"===n.src&&g(),"popstate"!==n.src||i.hasRoute(i.getPath())||e.Object.isEmpty(n.newVal)||i.navigate(i.getPath()),t.getViewCounter().flushQueue({resetDuplicateTracking:!0}),o||t.updateModelRefetchState(),o=!1}function w(e){i.set("previousView",e.prevVal)}function h(n){var i=this.get("activeView");if(void 0===i.getViewDataFromHistory("referrer")&&i.setViewDataOnHistory("referrer",t.getPreviousURL()),t.dataLayer.updateDataLayer(),e.Snowplough&&e.Snowplough.sendPageView(i),e.DeferImages.update(),t.adManager.setAdCouldBeShown(!1),e.config.win.onappclientnav)try{e.config.win.onappclientnav()}catch(n){}e.Accessibility.manageFocusOutlines(i),void 0!==window._sift&&window._sift.push&&window._sift.push(["_trackPageview"]),s&&t.requiresCookieConsent&&m(),window.addEventListener("message",(function(e){"flickr:CMPframed"===e.data&&(s=!0,t.requiresCookieConsent&&m())})),t.trustarcConsentManager&&(t.trustarcConsentManager.reset(),t.trustarcConsentManager.load())}function m(){window.__tcfapi&&window.__tcfapi("ping",2,(function(n){n.cmpLoaded||(r.info("CMP Loaded value is false"),e.Snowplough&&e.Snowplough.sendStructuredEvent({category:"cookie_consent",action:"consent_issue",label:"cmpLoaded undefined"}))}))}function v(n){return new e.Promise((function(o,a){var c=setTimeout((function(){a(new Error("Initial View Timeout"))}),12e3);n.params.appContext=t,i.showContent(e.one("#content > .view"),{view:{name:n.name,config:n.params}},(function(n){e.one("body").removeClass("dark-loader"),n._params&&(n._params.keyEventScope=n.name+n._yuid),n.setViewDataOnHistory("referrer",document.referrer),n.set("isRootView",!0),t.dataLayer.updateDataLayer(),n.initialize().then((function(){e.Snowplough&&(e.Snowplough.setUserId(),e.Snowplough.sendPageView(n)),t.getKeyboardManager().setCurrentKeyEventScope(n.name+n._yuid),g(),e.DeferImages.init(),e.Accessibility.manageFocusOutlines(n),l(["campaignID","linkID"]),(function(){if(e.config.flickr.requestConfig&&e.config.flickr.requestConfig.auth&&e.config.flickr.requestConfig.auth.isInsecureGod){var n=e.all("[data-view-signature]");n.size()&&r.warn("View signature mismatches detected! A view likely modified the `params` object directly.",{views:n.getDOMNodes()})}})(),clearTimeout(c),o()})).then(null,(function(e){throw r.error("There was a problem initializing or activating the view.",{err:e}),a(),e})),s&&t.requiresCookieConsent&&m(),window.addEventListener("message",(function(e){"flickr:CMPframed"===e.data&&(s=!0,t.requiresCookieConsent&&m())}))})),i.before("navigate",f),i.before("activeViewChange",w),e.on("history:change",p),i.after("activeViewChange",h)}))}function C(n,r,o,a){var s,c={};return e.Views&&e.Views[n]&&(c[n]={type:e.Views[n],preserve:!1}),i=new e.App({serverRouting:!0,viewContainer:"#content",container:"#content",linkSelector:":not(.server-only-link):not([target=_blank])",scrollToTop:!1,views:c}),new e.FlickrRouter(i,e.config.flickr.routes,(function(){return e.Promise.resolve(null)})),a.auth=r,a.flapp=i,s=a,window.appContext=new e.AppContext(s),(t=window.appContext).routeTiming=a.routeTiming,t.routeConfig=a.routeConfig,e.mix(e.Node.DOM_EVENTS,{transitionend:!0,webkitTransitionEnd:!0}),r&&r.user&&r.user.ispro||e.use("prbd"),e.ClientTransport.authorize(t),window.snowplough=e.Snowplough,window.addEventListener("unload",(function(n){e.ClientTransport.unloading=!0})),window.addEventListener("load",(function(n){e.ClientTransport.unloading=!1})),t.adManager.detectAdBlocker(),t.trustarcConsentManager&&t.trustarcConsentManager.load(),t.modelImportExport.importAll(o)}e.ClientApp={init:function(n){if(void 0===n)return e.Promise.reject({message:"Invalid config object supplied, was undefined."});var i,r,o=n.initialView,a=n.modelExport,s=n.auth,f=this;return s||c(),i=s&&n.auth.signedIn?n.auth.csrf:null,e.config.flickr.csrf.token=i,e.config.flickr.requestConfig={auth:s},n.params.routeTiming=n.routeTiming,n.params.routeConfig=n.routeConfig,l(e.config.flickr.routing_params),window.location.search&&window.location.search.match(/yc=/)&&(r=e.QueryString.parse(window.location.search.replace("?","")),e.config.flickr.ycParam=r.yc),e.transportFactory=function(n,t){return new e.ClientTransport(t)},u(o.name,e).then((function(){return C(o.name,s,a,n.params)})).then((function(){return v(o)})).then((function(){var n;(n=e.one("link#rollup-css"))?n.get("sheet")?(t.isCSSLoaded=!0,e.fire("css-loaded")):n.once("load",(function(){t.isCSSLoaded=!0,e.fire("css-loaded")})):(t.isCSSLoaded=!0,e.fire("css-loaded")),e.AnchorRepositioner.jumpTo(),e.config.win.addEventListener("beforeunload",d.bind(f))})).then(e.config.win.onappinit)},beforeUnload:d,beforeNavigate:f,_loadInitialView:u,langBundles:["client-app"],disableClientNav:c,getScrollSection:function n(t,i,r){var o=e.one(document.elementFromPoint(i,r)),a=o.ancestor("[data-scroll-section]",!0);if(a)return a.getAttribute("data-scroll-section");var s,c=o.ancestor(".view",!0);if(c){if((s=c.getAttribute("class").match(/[\S]+-view/)[0])===t.name&&i===window.innerWidth/2){var l=n(t,i/2,r);return l!==t.name?l:n(t,i+i/2,r)}return s}}},e.rapidTracker={beacon:function(){}},e.mix(e.ClientApp,e.Localizable)}),"@VERSION@",{requires:["app-base","app-content","router","app-context","client-transport","flickr-router","handlebars-helpers","loader-bar","murmurhash","node","site-key","flickr-promise","global-events","querystring-parse-simple","querystring-stringify-simple","storage-helper","keyboard-manager","dom","overflow-helper","defer-images","accessibility","anchor-repositioner","atics","snowplough"],affinity:"client",langBundles:["client-app"]});YUI.add("csrf-updater",(function(t){"use strict";var e=require("hermes-core/flog")("csrf");t.CsrfUpdater=function(t){this.flickrAPI=t,this._tasks=[]},t.CsrfUpdater.prototype.getKey=function(){return t.config.flickr.csrf.token||null},t.CsrfUpdater.prototype.isExpired=function(){return!!t.config.flickr.csrf.token&&Date.now()/1e3>t.config.flickr.csrf.csrfExpiresAt},t.CsrfUpdater.prototype.invalidate=function(t){if(t||(t=0),!(t<(this._lastStored||0)))return this.setExpired()},t.CsrfUpdater.prototype.setExpired=function(){return t.config.flickr.csrf.csrfExpiresAt=0},t.CsrfUpdater.prototype.store=function(e,r){this._lastStored=Date.now(),r||(r=Math.floor(this._lastStored/1e3)),t.config.flickr.csrf.token=e,t.config.flickr.csrf.csrfFetched=r,t.config.flickr.csrf.csrfExpiresAt=r+t.config.flickr.csrf.fetch_interval,this.drainQueue()},t.CsrfUpdater.prototype.pushToQueue=function(t){this._tasks.push(t)},t.CsrfUpdater.prototype.drainQueue=function(){for(;this._tasks.length;)this._tasks.shift().resolve()},t.CsrfUpdater.prototype.hasQueuedTasks=function(){return!!this._tasks.length},t.CsrfUpdater.prototype.scheduleFutureFetch=function(){t.config.flickr.csrf.token&&(this._timerFutureFetch=setTimeout(this.fetch.bind(this),1e3*t.config.flickr.csrf.fetch_interval))},t.CsrfUpdater.prototype.scheduleRetry=function(e){var r=this,s=this._fetchRuns>4?1:Math.pow(2,(this._fetchRuns||1)-1)/10,i=t.config.flickr.csrf.retry_interval*s;clearTimeout(this._timerRetry),this._timerRetry=setTimeout((function(){r._timerRetry=null,r.fetch(e)}),1e3*i)},t.CsrfUpdater.prototype.fetch=function(r){var s=this,i=s.hasQueuedTasks();if(clearTimeout(this._timerFutureFetch),YUI.Env.isServer){if(!r&&(r=new t.Promise((function(t,e){this.resolve=t,this.reject=e})),this.pushToQueue(r),i))return r;this._fetchRuns||(this._fetchRuns=0),this._fetchRuns++,this.flickrAPI.fetchCsrf().then((function(t){var i=t.token;if(!t.token)return e.error("Failed to fetch csrf token",t),void s.scheduleRetry(r);e.log("Received new csrf token",t),s._fetchRuns=0,s.store(i),s.scheduleFutureFetch()}),(function(t){e.error("Failed to fetch csrf token",{err:t}),s.scheduleRetry(r)}))}else t.ClientApp&&(t.ClientApp.disableClientNav(),e.error("Cannot fetch CSRF on client"),r=t.Promise.reject({msg:"csrf is unavailable"}));return r}}),"@VERSION@",{requires:["client-app"]});YUI.add("hermes-template-photo-page-scrappy",(function(l,e){var n=l.Template.Handlebars.revive({1:function(l,e,n,t,o){var a=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return"\t"+l.escapeExpression((a(n,"outlet")||e&&a(e,"outlet")||l.hooks.helperMissing).call(null!=e?e:l.nullContext||{},null!=e?a(e,"photo-page-leader-moola-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:4,column:1},end:{line:4,column:40}}}))+"\n"},3:function(l,e,n,t,o){var a=null!=e?e:l.nullContext||{},r=l.hooks.helperMissing,u=l.escapeExpression,i=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return"\t"+u((i(n,"outlet")||e&&i(e,"outlet")||r).call(a,null!=e?i(e,"mobile-photo-well-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:9,column:1},end:{line:9,column:34}}}))+"\n\t"+u((i(n,"outlet")||e&&i(e,"outlet")||r).call(a,null!=e?i(e,"mobile-photo-engagement-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:10,column:1},end:{line:10,column:40}}}))+"\n"},5:function(l,e,n,t,o){var a=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return"\t"+l.escapeExpression((a(n,"outlet")||e&&a(e,"outlet")||l.hooks.helperMissing).call(null!=e?e:l.nullContext||{},null!=e?a(e,"photo-well-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:12,column:1},end:{line:12,column:27}}}))+"\n"},7:function(l,e,n,t,o){var a=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return"\t"+l.escapeExpression((a(n,"outlet")||e&&a(e,"outlet")||l.hooks.helperMissing).call(null!=e?e:l.nullContext||{},null!=e?a(e,"moola-sticky-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:17,column:1},end:{line:17,column:29}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(l,e,n,t,o){var a,r=null!=e?e:l.nullContext||{},u=l.hooks.helperMissing,i=l.escapeExpression,c=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return i((c(n,"outlet")||e&&c(e,"outlet")||u).call(r,null!=e?c(e,"global-nav-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+"\n\n"+(null!=(a=c(n,"if").call(r,null!=e?c(e,"canShowLeaderAd"):e,{name:"if",hash:{},fn:l.program(1,o,0),inverse:l.noop,data:o,loc:{start:{line:3,column:0},end:{line:5,column:7}}}))?a:"")+"\n\n"+(null!=(a=c(n,"if").call(r,null!=e?c(e,"showMobileWell"):e,{name:"if",hash:{},fn:l.program(3,o,0),inverse:l.program(5,o,0),data:o,loc:{start:{line:8,column:0},end:{line:13,column:7}}}))?a:"")+"\n"+i((c(n,"outlet")||e&&c(e,"outlet")||u).call(r,null!=e?c(e,"sub-photo-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:15,column:0},end:{line:15,column:25}}}))+"\n"+(null!=(a=c(n,"if").call(r,null!=e?c(e,"showNonUSSticky"):e,{name:"if",hash:{},fn:l.program(7,o,0),inverse:l.noop,data:o,loc:{start:{line:16,column:0},end:{line:18,column:7}}}))?a:"")+i((c(n,"outlet")||e&&c(e,"outlet")||u).call(r,null!=e?c(e,"footer-full-view"):e,{name:"outlet",hash:{},data:o,loc:{start:{line:19,column:0},end:{line:19,column:27}}}))+"\n"},useData:!0}),t={};l.Array.each([],(function(e){var n=l.Template.get("hermes/"+e);n&&(t[e]=n)})),l.Template.register("hermes/photo-page-scrappy",(function(e,o){return(o=o||{}).partials=o.partials?l.merge(t,o.partials):t,n(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("signin-helper",(function(e){function n(n,o){e.FlickrStorage.store(n,o)}function o(e,n){var o=n.key,r=n.value;switch(o){case"fave":return(function(e,n){var o=n.id;e.getModelRegistry("photo-engagement-models").then((function(e){var n=e.proxy(o);n.registry.addAsFave(o)&&n.remoteUpdate()}))})(e,r),!0;case"share":return!1}}function r(n,o){var r,t;o&&o.withPopup?(r=e.config.win.open(i(o),"_blank","height=650,resizable=1,scrollbars=1,location=yes"),t=setInterval((function(){r.closed&&(clearInterval(t),window.location.reload())}),1e3)):e.config.win.location=i(o)}function i(n){(n=n||{}).closeWhenDone&&(n.postLoginUrl=e.url("/photo_grease_postlogin.gne",{protocol:!1}));var o=n.postLoginUrl||e.config.win.location.href;return(n.url||e.url("/signin/",{protocol:!1}))+"?redir="+encodeURIComponent(o)}function t(n,o){var r=(o=o||{}).postLoginUrl||e.config.win.location.href,i=o.url||e.url("/signup/",{protocol:!1});e.config.win.location=i+"?redir="+encodeURIComponent(r)}e.FlickrStorage={_storageKey:"flickrStorage",store:function(n,o){try{var r=[];e.StorageHelper.hasEntries(this._storageKey)&&(r=this.retrieve()),r.push({key:n,value:o}),e.StorageHelper.setItem(this._storageKey,JSON.stringify(r))}catch(e){}},retrieve:function(){var n={};try{n=JSON.parse(e.StorageHelper.getItem(this._storageKey))}catch(e){}return n},remove:function(){try{e.StorageHelper.remove(this._storageKey)}catch(e){}},hasEntries:function(){return e.StorageHelper.hasEntries(this._storageKey)}},e.SigninHelper={savePreLoginAction:n,addPendingFave:function(e,o){var i="fave";n(i,e),r(i,o)},addPendingComment:function(e,n){r("comment",n)},addPendingShare:function(e,o){var i="share";n(i,e),r(i,o)},addPendingFollow:function(e,o){var i="follow";n(i,e),r(i,o)},addPendingJoinGroup:function(e,o){var i="joingroup";n(i,e),r(i,o)},addPendingDownload:function(e,o){var i="download";n(i,e),r(i,o)},checkPendingQueue:function(n){var r,i,t=[];if(n){if(e.FlickrStorage.hasEntries())for(i in r=e.FlickrStorage.retrieve())o(n,r[i])||t.push(r[i]);return e.FlickrStorage.remove(),t}},_redirectToSignin:r,_redirectToSignUp:t,_getSigninUrl:i,signUpPendingFave:function(e,o){var r="fave";n(r,e),t(r,o)},signUpPendingComment:function(e,n){t("comment",n)},signUpPendingFollow:function(e,o){var r="follow";n(r,e),t(r,o)},signUpPendingJoinGroup:function(e,o){var r="joingroup";n(r,e),t(r,o)},signUpPendingDownload:function(e,o){var r="download";n(r,e),t(r,o)}}}),"@VERSION@",{requires:["url","storage-helper"]});YUI.add("safety-level-helper",(function(e){e.SafetyHelper={getSafetyLevelString:function(e,r){return e=parseInt(e),"search"===r&&(e-=1),1===e?"moderate":2===e?"restricted":"safe"}}}),"@VERSION@",{requires:[]});YUI.add("yui-throttle",function(e,t){
/*! Based on work by Simon Willison: http://gist.github.com/292562 */
;e.throttle=function(t,n){n=n?n:e.config.throttleTime||150;if(n===-1)return function(){t.apply(this,arguments)};var r=e.Lang.now();return function(){var i=e.Lang.now();i-r>n&&(r=i,t.apply(this,arguments))}}},"3.16.0",{requires:["yui-base"]});
YUI.add("hermes-template-photo-well-scrappy",(function(n,l){var e=n.Template.Handlebars.revive({1:function(n,l,e,t,a){return" enable-zoom"},3:function(n,l,e,t,a){return" no-click"},5:function(n,l,e,t,a){return" is-hidden"},7:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"prev-url")||(null!=l?r(l,"prev-url"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"prev-url",hash:{},data:a,loc:{start:{line:3,column:143},end:{line:3,column:155}}}):o)},9:function(n,l,e,t,a){return"#"},11:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"prev-title")||(null!=l?r(l,"prev-title"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"prev-title",hash:{},data:a,loc:{start:{line:3,column:196},end:{line:3,column:210}}}):o)},13:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"next-url")||(null!=l?r(l,"next-url"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"next-url",hash:{},data:a,loc:{start:{line:10,column:143},end:{line:10,column:155}}}):o)},15:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"next-title")||(null!=l?r(l,"next-title"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"next-title",hash:{},data:a,loc:{start:{line:10,column:197},end:{line:10,column:211}}}):o)},17:function(n,l,e,t,a){var o=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,i=n.escapeExpression,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t"+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"photo-sidebar-toggle-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:13,column:2},end:{line:13,column:38}}}))+"\n\t\t"+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"attribution-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:14,column:2},end:{line:14,column:29}}}))+"\n\t\t"+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"people-notes-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:15,column:2},end:{line:15,column:30}}}))+"\n\t\t"+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"photo-engagement-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:16,column:2},end:{line:16,column:34}}}))+"\n"},19:function(n,l,e,t,a){var o,r=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u="function",c=n.escapeExpression,s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t<a class='entry-type do-not-evict' href='"+c(typeof(o=null!=(o=s(e,"entryURL")||(null!=l?s(l,"entryURL"):l))?o:i)===u?o.call(r,{name:"entryURL",hash:{},data:a,loc:{start:{line:20,column:43},end:{line:20,column:55}}}):o)+'\'><div class="icon"></div> '+c(typeof(o=null!=(o=s(e,"backToLabel")||(null!=l?s(l,"backToLabel"):l))?o:i)===u?o.call(r,{name:"backToLabel",hash:{},data:a,loc:{start:{line:20,column:82},end:{line:20,column:97}}}):o)+"</a>\n"},21:function(n,l,e,t,a){var o,r=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<a href="'+u("function"==typeof(o=null!=(o=c(e,"similaritySearchURL")||(null!=l?c(l,"similaritySearchURL"):l))?o:i)?o.call(r,{name:"similaritySearchURL",hash:{},data:a,loc:{start:{line:24,column:11},end:{line:24,column:34}}}):o)+'" class="similarity-search-link" data-track="photoPageSimilaritySearchClick" title="'+u((c(e,"intlMessage")||l&&c(l,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS"},data:a,loc:{start:{line:24,column:118},end:{line:24,column:177}}}))+'"><svg class="icon icon-search"><use xlink:href="#icon-search"></use></svg></a>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,e,t,a){var o,r,i=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,c="function",s=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<div class="height-controller'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"enableZoom"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:29},end:{line:1,column:66}}}))?o:"")+'" style="height: '+s(typeof(r=null!=(r=p(e,"height")||(null!=l?p(l,"height"):l))?r:u)===c?r.call(i,{name:"height",hash:{},data:a,loc:{start:{line:1,column:83},end:{line:1,column:93}}}):r)+'px;">\n\n\t<a class="navigate-target navigate-prev'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"prev-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:3,column:40},end:{line:3,column:85}}}))?o:"")+(null!=(o=p(e,"if").call(i,null!=l?p(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:3,column:85},end:{line:3,column:119}}}))?o:"")+'" href="'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(7,a,0),inverse:n.program(9,a,0),data:a,loc:{start:{line:3,column:127},end:{line:3,column:171}}}))?o:"")+'" title="'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(11,a,0),inverse:n.noop,data:a,loc:{start:{line:3,column:180},end:{line:3,column:217}}}))?o:"")+'" data-track="prevPhotoButtonClick" data-action="ad" style="height: '+s(typeof(r=null!=(r=p(e,"navHeight")||(null!=l?p(l,"navHeight"):l))?r:u)===c?r.call(i,{name:"navHeight",hash:{},data:a,loc:{start:{line:3,column:285},end:{line:3,column:298}}}):r)+'px;"><span class="hide-text">&larr;</span></a>\n\n\t<div class="photo-well-media-wrapper">\n\t'+s((p(e,"outlet")||l&&p(l,"outlet")||u).call(i,null!=l?p(l,"photo-well-media-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:6,column:1},end:{line:6,column:33}}}))+"\n\t"+s((p(e,"outlet")||l&&p(l,"outlet")||u).call(i,null!=l?p(l,"photo-notes-scrappy-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:7,column:1},end:{line:7,column:36}}}))+'\n\t</div>\n\n\t<a class="navigate-target navigate-next'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"next-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:40},end:{line:10,column:85}}}))?o:"")+(null!=(o=p(e,"if").call(i,null!=l?p(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:85},end:{line:10,column:119}}}))?o:"")+'" href="'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"next-url"):l,{name:"if",hash:{},fn:n.program(13,a,0),inverse:n.program(9,a,0),data:a,loc:{start:{line:10,column:127},end:{line:10,column:171}}}))?o:"")+'"  title="'+(null!=(o=p(e,"if").call(i,null!=l?p(l,"next-url"):l,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:181},end:{line:10,column:218}}}))?o:"")+'" data-track="nextPhotoButtonClick" data-action="ad" style="height: '+s(typeof(r=null!=(r=p(e,"navHeight")||(null!=l?p(l,"navHeight"):l))?r:u)===c?r.call(i,{name:"navHeight",hash:{},data:a,loc:{start:{line:10,column:286},end:{line:10,column:299}}}):r)+'px;"><span class="hide-text">&rarr;</span></a>\n\n'+(null!=(o=p(e,"unless").call(i,null!=l?p(l,"is-ad"):l,{name:"unless",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:1},end:{line:17,column:12}}}))?o:"")+"\n"+(null!=(o=p(e,"unless").call(i,null!=l?p(l,"hideBackToLink"):l,{name:"unless",hash:{},fn:n.program(19,a,0),inverse:n.noop,data:a,loc:{start:{line:19,column:1},end:{line:21,column:12}}}))?o:"")+"\n"+(null!=(o=p(e,"if").call(i,null!=l?p(l,"similaritySearchURL"):l,{name:"if",hash:{},fn:n.program(21,a,0),inverse:n.noop,data:a,loc:{start:{line:23,column:1},end:{line:25,column:8}}}))?o:"")+"\n\t"+s((p(e,"outlet")||l&&p(l,"outlet")||u).call(i,null!=l?p(l,"context-slider-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:27,column:1},end:{line:27,column:31}}}))+"\n</div>\n"},useData:!0}),t={};n.Array.each([],(function(l){var e=n.Template.get("hermes/"+l);e&&(t[l]=e)})),n.Template.register("hermes/photo-well-scrappy",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(t,a.partials):t,e(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-page-right-size-express",(function(t,e){var n=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,e,n,o,i){var h,a=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",p=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n<script type="text/javascript" nonce="'+p(typeof(h=null!=(h=d(n,"cspNonce")||(null!=e?d(e,"cspNonce"):e))?h:l)===r?h.call(a,{name:"cspNonce",hash:{},data:i,loc:{start:{line:12,column:38},end:{line:12,column:50}}}):h)+'">\n\n\t(function(){\n\n\t\tvar PADDING_HORIZONTAL = 40;\n\n\t\twindow.getPhotoWellHeight = function () {\n\n\t\t\tvar minHeight = 500,\n\t\t\t    winWidth = window.innerWidth,\n\t\t\t    winHeight = window.innerHeight - 50,  \n\t\t\t    ratioNarrow = 1,\n\t\t\t    ratioRegular = 2.3,\n\t\t\t    ratioTransitional = 2.75,\n\t\t\t    idealSubphotoHeight = 120,\n\t\t\t    breakHeightNarrow = (winWidth / ratioNarrow) + idealSubphotoHeight,\n\t\t\t    breakHeightRegular = (winWidth / ratioRegular) + idealSubphotoHeight,\n\t\t\t    breakHeightTransitional = winWidth / ratioTransitional,\n\t\t\t    newPhotoWellHeight;\n\n\t\t\tif (winHeight > breakHeightNarrow) {\n\n\t\t\t\tnewPhotoWellHeight = winWidth / ratioNarrow;\n\n\t\t\t} else if (winHeight > breakHeightRegular) {\n\n\t\t\t\tnewPhotoWellHeight = winHeight - idealSubphotoHeight;\n\n\t\t\t} else if (winHeight > breakHeightTransitional) {\n\n\t\t\t\tnewPhotoWellHeight = winHeight - idealSubphotoHeight + idealSubphotoHeight * (winHeight - breakHeightRegular) / (breakHeightTransitional - breakHeightRegular);\n\n\t\t\t} else {\n\n\t\t\t\tnewPhotoWellHeight = winHeight;\n\n\t\t\t}\n\n\t\t\treturn Math.max(minHeight, Math.round(newPhotoWellHeight));\n\n\t\t}\n\n\t\tfunction domReady () {\n\n\t\t\ttry {\n\n\t\t\t\tif (document.getElementsByClassName("main-photo")[0]) {\n\n\t\t\t\t\tvar photoWellView = document.querySelectorAll(".photo-well-scrappy-view, .photo-well-scrappy-view-OLD")[0],\n\t\t\t\t\t    heightController = photoWellView.getElementsByClassName("height-controller")[0],\n\t\t\t\t\t    photoWellMediaView = document.querySelectorAll(".photo-well-media-scrappy-view, .photo-well-media-scrappy-view-OLD")[0],\n\t\t\t\t\t    photoImageElement = photoWellMediaView.getElementsByClassName("main-photo")[0],\n\t\t\t\t\t    photoWidth = '+p(typeof(h=null!=(h=d(n,"photoWidth")||(null!=e?d(e,"photoWidth"):e))?h:l)===r?h.call(a,{name:"photoWidth",hash:{},data:i,loc:{start:{line:100,column:22},end:{line:100,column:36}}}):h)+",\n\t\t\t\t\t    photoHeight = "+p(typeof(h=null!=(h=d(n,"photoHeight")||(null!=e?d(e,"photoHeight"):e))?h:l)===r?h.call(a,{name:"photoHeight",hash:{},data:i,loc:{start:{line:101,column:23},end:{line:101,column:38}}}):h)+',\n\t\t\t\t\t    photoAspectRatio = photoWidth / photoHeight,\n\t\t\t\t\t    photoWellHeight = window.getPhotoWellHeight(),\n\t\t\t\t\t    photoWellMediaViewPadding = {\n\t\t\t\t\t        top: parseInt(getComputedStyle(photoWellMediaView)[\'paddingTop\'].match(/[0-9]+/)[0], 10),\n\t\t\t\t\t        right: PADDING_HORIZONTAL,\n\t\t\t\t\t        bottom: parseInt(getComputedStyle(photoWellMediaView)[\'paddingBottom\'].match(/[0-9]+/)[0], 10),\n\t\t\t\t\t        left: PADDING_HORIZONTAL\n\t\t\t\t\t    },\n\t\t\t\t\t    canvasSize = {\n\t\t\t\t\t        height: photoWellHeight - photoWellMediaViewPadding.top - photoWellMediaViewPadding.bottom,\n\t\t\t\t\t        width: window.innerWidth - photoWellMediaViewPadding.left - photoWellMediaViewPadding.right\n\t\t\t\t\t    };\n\n\t\t\t\t\theightController.style.height = photoWellHeight + "px";\n\n\t\t\t\t\tif (photoWidth <= canvasSize.width && photoHeight <= canvasSize.height) {\n\t\t\t\t\t\tphotoImageElement.style.height = photoHeight + "px";\n\t\t\t\t\t\tphotoImageElement.style.width = photoWidth + "px";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (photoAspectRatio < 1 || Math.round(canvasSize.width / photoAspectRatio) > canvasSize.height) {\n\t\t\t\t\t\t\tphotoImageElement.style.height = canvasSize.height + "px";\n\t\t\t\t\t\t\tphotoImageElement.style.width = Math.round(canvasSize.height * photoAspectRatio) + "px";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tphotoImageElement.style.height = Math.round(canvasSize.width / photoAspectRatio) + "px";\n\t\t\t\t\t\t\tphotoImageElement.style.width = canvasSize.width + "px";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tif (window.sendRequest) {\n\t\t\t\t\twindow.sendRequest(\'flickr.hermes.photoDimensionCorrectionError\', \'There was a JS error when trying to correct a server rendered photo.\');\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tif (document.readyState !== \'loading\') {\n\t\t\tdomReady();\n\t\t} else {\n\t\t\tdocument.addEventListener(\'DOMContentLoaded\', domReady);\n\t\t}\n\n\t}());\n\n<\/script>\n'},useData:!0}),o={};t.Array.each([],(function(e){var n=t.Template.get("hermes/"+e);n&&(o[e]=n)})),t.Template.register("hermes/photo-page-right-size-express",(function(e,i){return(i=i||{}).partials=i.partials?t.merge(o,i.partials):o,n(e,i)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});